# Supabase 설정 및 스키마 문서

# Supabase 설정 및 스키마 문서

> **사전 작업:** 아직 Supabase 프로젝트를 생성하지 않았다면, [인프라 시작하기 (Getting Started)](./getting-started.md) 문서를 먼저 진행해주세요.

## 1. 개요
이 문서는 React Todo 애플리케이션의 백엔드 역할을 하는 Supabase 프로젝트의 설정, 데이터베이스 스키마, 보안 정책을 기술한다.

## 2. 프로젝트 연동 정보
React 애플리케이션에서 Supabase와 통신하기 위해 아래의 환경 변수가 필요하다. 이 값들은 Supabase 프로젝트 대시보드의 **Settings > API** 메뉴에서 확인할 수 있다.

프로젝트 루트 디렉터리에 `.env` 파일을 생성하고 아래와 같이 변수를 추가한다.

```
VITE_SUPABASE_URL=your_supabase_project_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

**참고:** `VITE_` 접두사는 Vite를 사용하는 React 프로젝트에서 환경 변수를 클라이언트 사이드 코드에 노출시키기 위해 필요하다.

## 3. 데이터베이스 스키마

### 3.1. `todos` 테이블 생성
Supabase 대시보드의 **SQL Editor**에서 아래 쿼리를 실행하여 `todos` 테이블을 생성한다.

```sql
-- todos 테이블 생성
CREATE TABLE public.todos (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id uuid REFERENCES auth.users NOT NULL,
  task text CHECK (char_length(task) > 0),
  is_completed boolean DEFAULT false NOT NULL,
  inserted_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL
);

-- 테이블 설명 추가
COMMENT ON TABLE public.todos IS 'Stores todo items for each user.';
```

## 4. Row Level Security (RLS) 정책
데이터 보안을 위해 `todos` 테이블에 RLS(행 수준 보안)를 활성화하고, 사용자별로 자신의 데이터에만 접근할 수 있도록 정책을 설정한다.

### 4.1. RLS 활성화
```sql
-- todos 테이블에 RLS 활성화
ALTER TABLE public.todos ENABLE ROW LEVEL SECURITY;
```

### 4.2. RLS 정책 생성
```sql
-- 사용자는 자신의 todo만 볼 수 있다 (SELECT)
CREATE POLICY "Users can view their own todos."
ON public.todos FOR SELECT
USING (auth.uid() = user_id);

-- 사용자는 자신의 todo만 추가할 수 있다 (INSERT)
CREATE POLICY "Users can insert their own todos."
ON public.todos FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- 사용자는 자신의 todo만 수정할 수 있다 (UPDATE)
CREATE POLICY "Users can update their own todos."
ON public.todos FOR UPDATE
USING (auth.uid() = user_id);

-- 사용자는 자신의 todo만 삭제할 수 있다 (DELETE)
CREATE POLICY "Users can delete their own todos."
ON public.todos FOR DELETE
USING (auth.uid() = user_id);
```

이 정책들은 현재 로그인된 사용자(`auth.uid()`)가 `todos` 테이블의 `user_id`와 일치하는 행에 대해서만 C,R,U,D 작업을 수행할 수 있도록 제한한다.
